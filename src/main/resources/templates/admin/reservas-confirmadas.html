<script>
  $(document).ready(function (){
    $("#enviarReserva").click(function () {

      const array = $("#formReserva").serializeArray();
      const json = {};
      $.each(array, function () {
        json[this.name] = "" + this.value || "";
      });
      $.ajax({
        type: "POST",
        url: "/reservas",
        data: JSON.stringify(json),
        contentType: "application/json; charset=utf-8",
        success: function () {
          // $("#enviarReserva").attr('disabled', 'disabled');
          cerrarModal();
        },
        error: function () {
          alert("Parece que algo ha ido mal, prueba más tarde...")
        },
      });
    });
  });
  $(document).on("click", ".confirmar", function () {
    const id = $(this).attr("reserva-id");
    console.log("Confirmando " + id);
    enviar("confirmar", id);
  });
  $(document).on("click", ".rechazar", function () {
    const id = $(this).attr("reserva-id");
    console.log("Rechazando " + id);
    enviar("rechazar", id);
  });
  // recuperarReservas
  $(document).on("click", "#buscar-dia", function () {
    loadDoc("/reservas/confirmadas?dia=" + $("#sel-dia").val());
  });

  function enviar(accion, id) {
    $.ajax({
      type: "POST",
      url: "http://localhost:8080/reservas/" + id + "/" + accion,
      success: function (data) {
        console.log("ta to bien");
        location.reload();
      },
      error: function () {
        alert("Algo ha ido mal...")
      },
    })
  }

  function saltaPaginaConf(elem) {
    loadDoc("/reservas/confirmadas?dia=" + $("#dia-seleccionado").text()
        + "&pagina=" + elem.getAttribute("pag"));
  }

  function cerrarModal() {
    document.getElementById('id01').style.display='none'
  }
</script>
<div class="w3-row">
  <h2>Reservas confirmadas <span th:text="${dia}"></span></h2>
  <form action="#">
    <label for="sel-dia">Día</label>
    <input type="date" th:attr="value=${dia}" id="sel-dia" name="dia" required>
    <button id="buscar-dia" type="button">Consultar</button>
  </form>
  <span id="dia-seleccionado" th:text="${dia}" hidden></span>
</div>
<div class="w3-display-container" th:if="${#lists.isEmpty(reservas)}">
  <div class="ww3-display-topmiddle w3-xxlarge">Parece que no hay reservas</div>
</div>
<table class="w3-table-all w3-card-4" th:if="${not #lists.isEmpty(reservas)}">
  <tr>
    <th>Hora</th>
    <th>Nombre</th>
    <th>Mail</th>
    <th>Teléfono</th>
    <th>Número de comensales</th>
    <th>Peticiones</th>
  </tr>
  <tr th:each="r:${reservas}" th:attr="id=${r.id}">
    <td th:text="${r.hora}"></td>
    <td th:text="${r.nombre}"></td>
    <td th:text="${r.mail}"></td>
    <td th:text="${r.telefono}"></td>
    <td th:text="${r.numeroComensales}"></td>
    <td th:text="${r.peticiones}"></td>
  </tr>
</table>
<br/>
<div class="w3-content">
  <div class="w3-bar w3-center">
    <button th:each="i : ${#numbers.sequence(0, last, 1)}"
            th:class="${i == current} ? 'w3-bar-item w3-button w3-blue' : 'w3-bar-item w3-button'"
            th:text="${i + 1}" th:attr="pag=${i}" onclick="saltaPaginaConf(this)"></button>
  </div>
</div>
<br>
<button onclick="document.getElementById('id01').style.display='block'"
        class="w3-button w3-blue w3-block">Nueva reserva
</button>
<div id="id01" class="w3-modal w3-animate-opacity">
  <div class="w3-modal-content w3-card-4">
    <header class="w3-container w3-blue">
        <span onclick="cerrarModal();"
              class="w3-button w3-large w3-display-topright">&times;</span>
      <h2>Nueva reserva</h2>
    </header>
    <div class="w3-container">
      <form id="formReserva">
        <p><input class="w3-input w3-padding-16 w3-border" type="text" name="nombre" placeholder="Nombre" required></p>
        <p><input class="w3-input w3-padding-16 w3-border" type="text" name="mail" placeholder="Mail" required></p>
        <p><input class="w3-input w3-padding-16 w3-border" type="text" name="telefono" placeholder="Teléfono"></p>
        <p><input class="w3-input w3-padding-16 w3-border" type="number" name="numeroComensales" placeholder="¿Cuántos serán?" required></p>
        <p><input class="w3-input w3-padding-16 w3-border" type="datetime-local" name="momentoReserva" placeholder="¿Cuándo será?" required th:attr="value=${fecha}"></p>
        <p><input class="w3-input w3-padding-16 w3-border" type="text" name="peticiones" placeholder="Algo que debamos saber"></p>
        <p><button class="w3-button w3-light-grey w3-block" type="button" id="enviarReserva">Enviar</button></p>
      </form>
    </div>
  </div>
</div>